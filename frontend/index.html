<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Simple Chatbot Frontend</title>
<style>
  pre { background: #f4f4f4; padding: 10px; }
</style>
<style>
  #chats-result {
    background-color: #f9f9f9;
    border: 1px solid #ccc;
    padding: 10px;
    color: #000;
    font-family: monospace;
    white-space: pre-wrap;
    max-height: 300px;
    overflow-y: auto;
  }
</style>

</head>
<body>

<h2>Register User</h2>
<input id="reg-username" placeholder="Username" />
<input id="reg-password" type="password" placeholder="Password" />
<button onclick="register()">Register</button>
<p id="reg-result"></p>

<hr />

<h2>Ask Question</h2>
<input id="ask-userid" placeholder="User ID (e.g. 1)" />
<input id="ask-question" placeholder="Your question" size="50" />
<button onclick="ask()">Ask</button>
<p id="ask-result"></p>

<hr />

<h2>Get Chats By User</h2>
<input id="getchats-userid" placeholder="User ID (e.g. 1)" />
<button onclick="getChats()">Get Chats</button>
<pre id="chats-result"></pre>

<script>
const API_BASE = 'http://127.0.0.1:8000';

async function register() {
  const username = document.getElementById('reg-username').value;
  const password = document.getElementById('reg-password').value;
  const res = await fetch(`${API_BASE}/register`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({username, password})
  });
  const data = await res.json();
  document.getElementById('reg-result').textContent = JSON.stringify(data, null, 2);
}

async function ask() {
  const user_id = parseInt(document.getElementById('ask-userid').value);
  const question = document.getElementById('ask-question').value;
  const res = await fetch(`${API_BASE}/ask`, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({user_id, question})
  });
  const data = await res.json();
  document.getElementById('ask-result').textContent = JSON.stringify(data, null, 2);
}

async function getChats() {
  const user_id = parseInt(document.getElementById('getchats-userid').value);
  if (!user_id) {
    alert('Please enter a valid User ID');
    return;
  }
  const res = await fetch(`${API_BASE}/chats`);
  const allChats = await res.json();
  console.log('All chats:', allChats);  // log all chats fetched
  const userChats = allChats.filter(chat => chat.user_id === user_id);
  console.log('Filtered chats for user:', userChats);  // log filtered chats
  document.getElementById('chats-result').textContent = JSON.stringify(userChats, null, 2);
}

</script>
</body>
</html>

